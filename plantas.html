<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1f7a4a" />

  <title>plantas | Verde Tom Paisagismo</title>
  <meta name="description" content="Portfólio de plantas da Verde Tom: jardins residenciais, condomínios e áreas comuns. Atendimento em BH, Nova Lima e Lagoa Santa." />
  <link rel="canonical" href="https://lucassousao.github.io/verdeTomPaisagismo/plantas.html" />
  <meta name="robots" content="index,follow" />

  <meta property="og:title" content="plantas | Verde Tom Paisagismo" />
  <meta property="og:description" content="Veja plantas e execuções em Belo Horizonte e região." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://lucassousao.github.io/verdeTomPaisagismo/plantas.html" />
  <meta property="og:image" content="https://lucassousao.github.io/verdeTomPaisagismo/assets/images/og.jpg" />

  <link rel="icon" href="assets/images/vt.webp" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link rel="stylesheet" href="assets/css/projects.css" />
  <link rel="stylesheet" href="assets/css/plantas.css" />
</head>

<body>
 <header class="site-header">
  <div class="header-inner">
    <a href="/verdeTomPaisagismo" class="logo" aria-label="Voltar para a Home">
      <img src="assets/images/logo.webp" alt="Verde Tom Paisagismo">
    </a>

    <!-- Botão do menu (aparece só no mobile) -->
<button class="menu-btn" type="button" aria-label="Abrir menu" aria-expanded="false" aria-controls="mainNav">
  <span class="menu-label"></span>
  <span class="menu-label"></span>
  <span class="menu-label"></span>
</button>

    <nav class="main-nav" id="mainNav" aria-label="Menu principal">
      <a href="/verdeTomPaisagismo">Início</a>
      <a href="atuacao.html">Atuação</a>
      <a href="sobre.html">Sobre</a>
      <a href="blog.html">Blog</a>
      <a href="contato.html">Contato</a>
    </nav>
  </div>
</header>

  <main>
    <section class="section">
  <div class="container">
    <h1>plantas</h1>
    <div id="plantsGrid" class="plants-grid"></div>
  </div>
</section>

<!-- MODAL (fora do grid) -->
<div id="projectModal" class="modal" aria-hidden="true">
  <button class="modal-close" type="button" aria-label="Fechar">✕</button>

  <div class="modal-inner modal-inner--project">
    <div class="plants-modal">
      <h2 id="prTitle" class="plants-modal__title"></h2>

 <div class="compare-wrapper">
  <!-- SETAS DESKTOP -->
  <button class="compare-nav compare-nav--prev compare-des" id="prPrevDesktop" type="button" aria-label="Imagem anterior">‹</button>

  <div class="compare" id="compareBox">
  <img id="prAfter" class="compare__img" alt="">
  <img id="prBefore" class="compare__img compare__before" alt="">
  <input id="prRange" class="compare__range" type="range" min="0" max="100" value="50" aria-label="Comparar antes e depois">
  <div class="compare__handle" id="prHandle"></div>
  <div class="compare-count" id="prCount"></div>
  <div class="compare__labels">
    <span>ANTES</span>
    <span>DEPOIS</span>
  </div>
</div>


  <button class="compare-nav compare-nav--next compare-des" id="prNextDesktop" type="button" aria-label="Próxima imagem">›</button>
</div>

<!-- CONTROLES MOBILE -->
<div class="compare-controls">
  <button class="compare-nav compare-nav--prev compare-mob" id="prPrevMobile" type="button" aria-label="Imagem anterior">‹</button>
  <button class="compare-nav compare-nav--next compare-mob" id="prNextMobile" type="button" aria-label="Próxima imagem">›</button>
</div>


      <!-- Texto fixo abaixo (da planilha) -->
      <div class="plants-modal__info">
        <div class="info-row">
        <div class="info-label">Por que usar</div>
        <div id="plPorque" class="info-value"></div>
        </div>

        <div class="info-row">
        <div class="info-label">Cuidados</div>
        <div id="plCuidados" class="info-value"></div>
        </div>

        <div class="info-row info-row--small">
        <div class="info-pill">
            <b>Nome científico:</b> <span id="plCientifico"></span>
        </div>
          <div class="plants-share">
        <a id="shareProjectWhatsApp" class="plants-share__btn" target="_blank" rel="noopener">
        Compartilhar no WhatsApp</a>
        <button id="copyProjectLink" class="plants-share__btn plants-share__btn--secondary" type="button">
        Copiar link</button>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

  </main>

<footer class="site-footer">
  <div class="container footer-inner">

    <div class="footer-main">
      <a class="footer-instagram" 
         href="https://www.instagram.com/verdetompaisagismo/" 
         target="_blank" 
         rel="noopener noreferrer"
         aria-label="Instagram Cardim Paisagismo">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor"
            d="M7.75 2h8.5A5.76 5.76 0 0 1 22 7.75v8.5A5.76 5.76 0 0 1 16.25 22h-8.5A5.76 5.76 0 0 1 2 16.25v-8.5A5.76 5.76 0 0 1 7.75 2Zm0 1.5A4.26 4.26 0 0 0 3.5 7.75v8.5A4.26 4.26 0 0 0 7.75 20.5h8.5a4.26 4.26 0 0 0 4.25-4.25v-8.5A4.26 4.26 0 0 0 16.25 3.5h-8.5ZM12 7a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Zm5.25-.88a.88.88 0 1 1 0 1.76a.88.88 0 0 1 0-1.76Z"/>
        </svg>
        instagram
      </a>

      <span class="footer-sep">•</span>

      <span>Belo Horizonte, Minas Gerais</span>
<br>
      <a href="mailto:contato@verdetompaisagismo.com.br">
        contato@verdetompaisagismo.com.br
      </a>

      <span class="footer-sep">•</span>

      <a href="wa.me/+5531987415012">
        +55 31 98741-5012
      </a>
    </div>

    <div class="footer-copy">
     © <span id="year"></span>  Verde Tom Paisagismo - Todos os direitos reservados.
    </div>

  </div>
<a href="/verdeTomPaisagismo/contato.html" class="floating-cta" aria-label="Enviar proposta">Entre em contato</a>

  <script src="assets/js/main.js"></script>
 <script>
(async function(){
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTdP_h8M1SSBrqtxsH0j0V6eQ9MN66HX4JhSG0KgP_wyGVZmVAfzMX_J-MFPqc90c54N4vpkjakM0pj/pub?gid=3559854&single=true&output=csv";

  // ===== helpers =====
  function pick(obj, keys){
    for (const k of keys){
      if (obj && Object.prototype.hasOwnProperty.call(obj, k)) return obj[k];
    }
    return "";
  }
  function norm(v){ return String(v || "").trim().toLowerCase(); }

  function slugify(s){
    return String(s || "")
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .toLowerCase()
      .trim()
      .replace(/[^a-z0-9]+/g, "-")
      .replace(/(^-|-$)/g, "");
  }

  function buildUrl(slug){
    const base = window.location.href.split("#")[0];
    return `${base}#${encodeURIComponent(slug)}`;
  }

  // se você já tem resolveImageSrc no main.js, ele será usado
  // fallback seguro caso não exista
  function isAbsoluteUrl(v){
    return /^https?:\/\//i.test(String(v || "").trim());
  }
  function getRepoBaseUrl(){
    return "https://lucassousao.github.io/verdeTomPaisagismo/";
  }
  function resolveImageSrcLocal(input){
    const raw = String(input || "").trim();
    if (!raw) return "";
    if (isAbsoluteUrl(raw)) return raw;
    const cleaned = raw.replace(/^\.?\//, "");
    return getRepoBaseUrl() + cleaned;
  }
  const resolveImg = (typeof window.resolveImageSrc === "function")
    ? window.resolveImageSrc
    : resolveImageSrcLocal;

  function parseCSV(text){
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i = 0; i < text.length; i++){
      const c = text[i];
      const n = text[i+1];

      if (c === '"' && inQuotes && n === '"'){ cur += '"'; i++; continue; }
      if (c === '"'){ inQuotes = !inQuotes; continue; }

      if (c === ',' && !inQuotes){ row.push(cur); cur = ""; continue; }

      if ((c === '\n' || c === '\r') && !inQuotes){
        if (cur.length || row.length){
          row.push(cur);
          rows.push(row);
        }
        cur = ""; row = [];
        if (c === '\r' && n === '\n') i++;
        continue;
      }

      cur += c;
    }
    if (cur.length || row.length){
      row.push(cur);
      rows.push(row);
    }

    const headers = (rows.shift() || []).map(h => String(h).replace(/^\uFEFF/, "").trim());
    return rows
      .filter(r => r.some(v => String(v||"").trim().length))
      .map(r => {
        const obj = {};
        headers.forEach((h, idx) => obj[h] = String(r[idx] ?? "").trim());
        return obj;
      });
  }

  // ===== DOM refs =====
  const grid = document.getElementById("plantsGrid");

  const modal = document.getElementById("projectModal");
  const btnClose = modal?.querySelector(".modal-close");

const plTitle      = modal?.querySelector("#plTitle");
const plPorque     = modal?.querySelector("#plPorque");
const plCuidados   = modal?.querySelector("#plCuidados");
const plCientifico = modal?.querySelector("#plCientifico");
  const prRange  = modal?.querySelector("#prRange");
  const prHandle = modal?.querySelector("#prHandle");
  const compareBox = modal?.querySelector("#compareBox");
  const prCount  = modal?.querySelector("#prCount");

  const prPrevDesktop = modal?.querySelector("#prPrevDesktop");
  const prNextDesktop = modal?.querySelector("#prNextDesktop");
  const prPrevMobile  = modal?.querySelector("#prPrevMobile");
  const prNextMobile  = modal?.querySelector("#prNextMobile");

  const shareWA = modal?.querySelector("#shareProjectWhatsApp");
  const btnCopy = modal?.querySelector("#copyProjectLink");

  // ===== modal scroll lock (opcional) =====
  let scrollY = 0;
  function lockBodyScroll(){
    scrollY = window.scrollY || 0;
    document.body.classList.add("modal-open");
    document.body.style.top = `-${scrollY}px`;
  }
  function unlockBodyScroll(){
    document.body.classList.remove("modal-open");
    document.body.style.top = "";
    window.scrollTo(0, scrollY);
  }

  // ===== slider single =====
  function setCompare(value){
    if (!prBefore || !prHandle) return;
    const v = Math.max(0, Math.min(100, Number(value)));
    prBefore.style.clipPath = `inset(0 ${100 - v}% 0 0)`;
    prHandle.style.left = `${v}%`;
  }

  function setCompareFromClientX(clientX){
    if (!compareBox || !prRange) return;
    const r = compareBox.getBoundingClientRect();
    if (!r.width) return;
    const x = Math.max(0, Math.min(r.width, clientX - r.left));
    const v = (x / r.width) * 100;
    prRange.value = v;
    setCompare(v);
  }

  let dragging = false;
  compareBox?.addEventListener("pointerdown", (e) => {
    if (!modal?.classList.contains("open")) return;
    e.preventDefault();
    dragging = true;
    compareBox.setPointerCapture?.(e.pointerId);
    setCompareFromClientX(e.clientX);
  });
  compareBox?.addEventListener("pointermove", (e) => {
    if (!dragging) return;
    setCompareFromClientX(e.clientX);
  });
  function endDrag(){ dragging = false; }
  compareBox?.addEventListener("pointerup", endDrag);
  compareBox?.addEventListener("pointercancel", endDrag);
  compareBox?.addEventListener("lostpointercapture", endDrag);
  compareBox?.addEventListener("pointerleave", endDrag);

  prRange?.addEventListener("input", (e) => setCompare(e.target.value));

  // ===== slides =====
  let plants = [];
  let slides = [];
  let slideIndex = 0;

  function getPlantImage(plant, i){
    // suporta "imagem 1" (com espaço) e variações
    return pick(plant, [
      `imagem ${i}`,
      `imagem${i}`,
      `Imagem ${i}`,
      `Imagem${i}`
    ]).trim();
  }

  function collectSlides(plant){
    const out = [];
    for (let i = 1; i <= 5; i++){
      const img = getPlantImage(plant, i);
      if (!img) continue;
      out.push({ after: img, mode: "single" });
    }
    return out;
  }

  function setNavButton(btn, shouldShow){
    if (!btn) return;
    btn.classList.toggle("is-hidden", !shouldShow);
    btn.disabled = !shouldShow;
  }

  function updateNavVisibility(){
    const total = slides.length;

    const controls = modal?.querySelector(".compare-controls");
    if (total <= 1){
      setNavButton(prPrevDesktop, false);
      setNavButton(prNextDesktop, false);
      setNavButton(prPrevMobile,  false);
      setNavButton(prNextMobile,  false);

      if (controls){
        controls.classList.remove("only-prev", "only-next");
        controls.classList.add("no-nav");
      }
      return;
    }

    const isFirst = slideIndex === 0;
    const isLast  = slideIndex === total - 1;

    const showPrev = !isFirst; // se NÃO é primeiro
    const showNext = !isLast;  // se NÃO é último

    setNavButton(prPrevDesktop, showPrev);
    setNavButton(prNextDesktop, showNext);
    setNavButton(prPrevMobile,  showPrev);
    setNavButton(prNextMobile,  showNext);

    // layout mobile: start/end quando só tem uma seta
    if (controls){
      controls.classList.remove("no-nav", "only-prev", "only-next");
      if (showPrev && !showNext) controls.classList.add("only-prev");   // só esquerda -> end
      else if (!showPrev && showNext) controls.classList.add("only-next"); // só direita -> start
    }
  }

  function applySlide(idx){
    if (!slides.length) return;

    slideIndex = Math.max(0, Math.min(slides.length - 1, idx));
    const s = slides[slideIndex];

    if (prAfter){
      prAfter.src = resolveImg(s.after);
      prAfter.alt = prTitle?.textContent ? `Imagem - ${prTitle.textContent}` : "Imagem";
      prAfter.style.clipPath = "none";
    }

    // modo single (sem antes/depois)
    if (prBefore){
      prBefore.src = "";
      prBefore.style.display = "none";
    }
    if (prRange)  prRange.style.display  = "none";
    if (prHandle) prHandle.style.display = "none";
    if (compareBox) compareBox.dataset.mode = "single";

    if (prCount) prCount.textContent = `${slideIndex + 1}/${slides.length}`;

    updateNavVisibility();
  }

  function goPrev(){ applySlide(slideIndex - 1); }
  function goNext(){ applySlide(slideIndex + 1); }

  prPrevDesktop?.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); goPrev(); });
  prNextDesktop?.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); goNext(); });
  prPrevMobile?.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); goPrev(); });
  prNextMobile?.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); goNext(); });

  document.addEventListener("keydown", (e) => {
    if (!modal?.classList.contains("open")) return;
    if (e.key === "ArrowLeft")  goPrev();
    if (e.key === "ArrowRight") goNext();
    if (e.key === "Escape") closeModal();
  });

  function openModal(plant){
  if (!modal) return;

  const titulo = pick(plant, ["titulo", "Título", "nome", "Nome"]).trim();
  const slug   = pick(plant, ["slug", "Slug"]).trim() || slugify(titulo);

  history.pushState(null, "", `#${encodeURIComponent(slug)}`);

  // ✅ textos do modal (colunas com acento e espaço)
  const cientifico = pick(plant, [
    "nome científico", "nome cientifico", "Nome científico", "Nome cientifico",
    "nome_cientifico", "nomeCientifico"
  ]).trim();

  const porque = pick(plant, [
    "por que", "por quê", "Por que", "Por quê",
    "porque", "Porquê", "porquê",
    "por_que", "porQue"
  ]).trim();

  const cuidados = pick(plant, [
    "cuidados", "Cuidados",
    "cuidado", "Cuidado"
  ]).trim();

  if (plTitle)      plTitle.textContent      = titulo || "Planta";
  if (plCientifico) plCientifico.textContent = cientifico || "-";
  if (plPorque)     plPorque.textContent     = porque || "-";
  if (plCuidados)   plCuidados.textContent   = cuidados || "-";

  // slides
  slides = collectSlides(plant);
  slideIndex = 0;

  if (!slides.length){
    console.warn("Planta publicada sem imagens 1..5:", plant);
    return;
  }

  applySlide(0);

  // share
  const url = buildUrl(slug);
  const shareText = `Veja esta planta do Verde Tom: ${titulo}\n${url}`;

  if (shareWA) shareWA.href = `https://wa.me/?text=${encodeURIComponent(shareText)}`;

  if (btnCopy){
    btnCopy.onclick = async () => {
      const old = btnCopy.textContent;
      try{
        await navigator.clipboard.writeText(url);
        btnCopy.textContent = "Link copiado!";
        setTimeout(() => btnCopy.textContent = old || "Copiar link", 1400);
      } catch {
        prompt("Copie o link:", url);
      }
    };
  }

  modal.classList.add("open");
  modal.setAttribute("aria-hidden", "false");
  lockBodyScroll();
}


  function closeModal(){
    if (!modal) return;
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
    if (btnCopy) btnCopy.onclick = null;
    unlockBodyScroll();
    history.pushState(null, "", window.location.href.split("#")[0]);
  }

  btnClose?.addEventListener("click", closeModal);
  modal?.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });

  // ===== fetch + render =====
  try{
    const res = await fetch(CSV_URL, { cache: "no-store" });
    if(!res.ok) throw new Error("Falha ao buscar CSV: " + res.status);
    const csv = await res.text();

    let raw = parseCSV(csv);

    // Debug rápido (remova depois)
    console.log("headers detectados:", raw[0] ? Object.keys(raw[0]) : "(sem linhas)");
    console.log("1a linha exemplo:", raw[0]);

    plants = raw.filter(p => norm(pick(p, ["status", "Status", "STATUS"])) === "publicado");

    if (!grid) return;

    grid.innerHTML = plants.map((p, idx) => {
      const titulo = pick(p, ["titulo", "Título", "nome", "Nome"]).trim();
      const slug = pick(p, ["slug", "Slug"]).trim() || slugify(titulo);
      const url = buildUrl(slug);

      const cats = pick(p, ["categorias", "Categorias"]).split(",").map(s => s.trim()).filter(Boolean);

      const img1 = getPlantImage(p, 1);

      return `
        <article class="card plants-card"
          data-idx="${idx}"
          data-slug="${slug}"
          role="button"
          tabindex="0"
        >
          <div class="plants-card__media">
            ${img1 ? `<img class="img-after" src="${resolveImg(img1)}" alt="${titulo}" loading="lazy">` : ``}
          </div>

          <div class="plants-card__body">
            <h3>${titulo || ""}</h3>

            <div class="plants-card__meta">
              <div class="plants-card__categories">
                ${cats.map(c => `<span class="badge">${c}</span>`).join("")}
              </div>

              <a class="small" href="${url}" onclick="event.preventDefault()">ver detalhes</a>
            </div>
          </div>
        </article>
      `;
    }).join("") || `<p class="small">Nenhum catálogo publicado ainda.</p>`;

    grid.addEventListener("click", (e) => {
      const card = e.target.closest(".plants-card");
      if(!card) return;
      const i = Number(card.dataset.idx);
      openModal(plants[i]);
    });

    grid.addEventListener("keydown", (e) => {
      if (e.key !== "Enter" && e.key !== " ") return;
      const card = e.target.closest(".plants-card");
      if(!card) return;
      e.preventDefault();
      const i = Number(card.dataset.idx);
      openModal(plants[i]);
    });

    // abre por hash
    function openBySlug(slug){
      const s = decodeURIComponent(String(slug || "")).trim();
      if(!s) return;
      const idx = plants.findIndex(p => (pick(p, ["slug","Slug"]).trim() || slugify(pick(p, ["titulo","Título","nome","Nome"]))) === s);
      if(idx >= 0) openModal(plants[idx]);
    }

    const hash = (window.location.hash || "").replace("#","").trim();
    if(hash) openBySlug(hash);

    window.addEventListener("hashchange", () => {
      const h = (window.location.hash || "").replace("#","").trim();
      if(h) openBySlug(h);
    });

  } catch(err){
    console.error(err);
  }
})();
</script>
</body>
</html>
