<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1f7a4a" />

  <title>Blog | Verde Tom Paisagismo</title>
  <meta name="description" content="Dicas de plantas, manutenção e paisagismo em BH e região. Conteúdo para orientar decisões e melhorar o cuidado com o jardim." />
  <link rel="canonical" href="https://lucassousao.github.io/verdeTomPaisagismo/blog.html" />
  <meta name="robots" content="index,follow" />

  <link rel="icon" href="assets/images/vt.webp" />
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body>
 <header class="site-header">
  <div class="header-inner">
    <a href="/verdeTomPaisagismo" class="logo" aria-label="Voltar para a Home">
      <img src="assets/images/logo.webp" alt="Verde Tom Paisagismo">
    </a>

    <!-- Botão do menu (aparece só no mobile) -->
<button class="menu-btn" type="button" aria-label="Abrir menu" aria-expanded="false" aria-controls="mainNav">
   <span class="menu-label"></span>
  <span class="menu-label"></span>
  <span class="menu-label"></span>
</button>

    <nav class="main-nav" id="mainNav" aria-label="Menu principal">
      <a href="/verdeTomPaisagismo">Início</a>
      <a href="sobre.html">Sobre</a>
      <a href="projetos.html">projetos</a>
      <a href="plantas.html">Plantas</a>
      <a href="blog.html">Blog</a>
      <a href="contato.html">Contato</a>
    </nav>
  </div>
</header>

  <main class="section">
    <section class="section">
  <div class="container">
    <h1>Blog</h1>
    <div id="blogGrid" class="grid-3"></div>

<div id="postModal" class="modal" aria-hidden="true">
  <button class="modal-close" type="button" aria-label="Fechar">✕</button>

  <div class="modal-inner">
    <div class="post-modal">

      <div class="post-hero">
        <img id="pmImage" class="post-hero__img" alt="">
      </div>

      <div class="post-content">
        <h2 id="pmTitle" class="post-title"></h2>
        <div class="share-actions">
  <a id="shareWhatsApp" class="cta" href="#" target="_blank" rel="noopener">Compartilhar no WhatsApp</a>
  <button id="copyLink" class="cta secondary" type="button">Copiar link</button>
</div>

        <div class="post-meta">
          <img id="pmAuthorPhoto" class="post-meta__photo" alt="">
          <div class="post-meta__text">
            <div id="pmAuthor" class="post-meta__author"></div>
            <div id="pmDate" class="post-meta__date small"></div>
          </div>
        </div>

        <div id="pmBody" class="post-body"></div>
      </div>

    </div>
  </div>
</div>
<div class="hero-cta" style="margin-top:10px">
            <a class="cta" href="contato.html">Quero cuidar do meu jardim</a>
          </div>
  </div>
  
</section>

  </main>

<footer class="site-footer">
  <div class="container footer-inner">

    <div class="footer-main">
      <a class="footer-instagram" 
         href="https://www.instagram.com/verdetompaisagismo/" 
         target="_blank" 
         rel="noopener noreferrer"
         aria-label="Instagram Cardim Paisagismo">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor"
            d="M7.75 2h8.5A5.76 5.76 0 0 1 22 7.75v8.5A5.76 5.76 0 0 1 16.25 22h-8.5A5.76 5.76 0 0 1 2 16.25v-8.5A5.76 5.76 0 0 1 7.75 2Zm0 1.5A4.26 4.26 0 0 0 3.5 7.75v8.5A4.26 4.26 0 0 0 7.75 20.5h8.5a4.26 4.26 0 0 0 4.25-4.25v-8.5A4.26 4.26 0 0 0 16.25 3.5h-8.5ZM12 7a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Zm5.25-.88a.88.88 0 1 1 0 1.76a.88.88 0 0 1 0-1.76Z"/>
        </svg>
        instagram
      </a>

      <span class="footer-sep">•</span>

      <span>Belo Horizonte, Minas Gerais</span>
<br>
      <a href="mailto:contato@verdetompaisagismo.com.br">
        contato@verdetompaisagismo.com.br
      </a>

      <span class="footer-sep">•</span>

      <a href="wa.me/+5531987415012">
        +55 31 98741-5012
      </a>
    </div>

    <div class="footer-copy">
     © <span id="year"></span>  Verde Tom Paisagismo - Todos os direitos reservados.
    </div>

  </div>

  <script src="assets/js/main.js"></script>
<script>
(async function(){
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTdP_h8M1SSBrqtxsH0j0V6eQ9MN66HX4JhSG0KgP_wyGVZmVAfzMX_J-MFPqc90c54N4vpkjakM0pj/pub?gid=0&single=true&output=csv";

  let posts = []; // ✅ fica acessível para openPostBySlug/hash

  function slugify(s){
    return String(s || "")
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .toLowerCase()
      .trim()
      .replace(/[^a-z0-9]+/g, "-")
      .replace(/(^-|-$)/g, "");
  }

  function buildPostUrl(slug){
    const base = window.location.href.split("#")[0];
    return `${base}#${encodeURIComponent(slug)}`;
  }

  function parseCSV(text){
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i = 0; i < text.length; i++){
      const c = text[i];
      const n = text[i+1];

      if (c === '"' && inQuotes && n === '"'){ cur += '"'; i++; continue; }
      if (c === '"'){ inQuotes = !inQuotes; continue; }

      if (c === ',' && !inQuotes){
        row.push(cur); cur = ""; continue;
      }
      if ((c === '\n' || c === '\r') && !inQuotes){
        if (cur.length || row.length){
          row.push(cur);
          rows.push(row);
        }
        cur = ""; row = [];
        if (c === '\r' && n === '\n') i++;
        continue;
      }
      cur += c;
    }
    if (cur.length || row.length){
      row.push(cur);
      rows.push(row);
    }

    const headers = rows.shift().map(h => h.replace(/^\uFEFF/, "").trim());
    return rows
      .filter(r => r.some(v => String(v||"").trim().length))
      .map(r => {
        const obj = {};
        headers.forEach((h, idx) => obj[h] = String(r[idx] ?? "").trim());
        return obj;
      });
  }

  function truncateByDevice(text){
    const clean = String(text || "").trim();
    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    const limit = isMobile ? 30 : 60;
    if (clean.length <= limit) return clean;
    return clean.slice(0, limit).trimEnd() + "…";
  }

  // Modal elements
  const modal = document.getElementById("postModal");
  const btnClose = modal?.querySelector(".modal-close");
  const pmImage = document.getElementById("pmImage");
  const pmTitle = document.getElementById("pmTitle");
  const pmAuthor = document.getElementById("pmAuthor");
  const pmAuthorPhoto = document.getElementById("pmAuthorPhoto");
  const pmDate = document.getElementById("pmDate");
  const pmBody = document.getElementById("pmBody");
  let scrollY = 0;

function lockBodyScroll(){
  scrollY = window.scrollY || 0;
  document.body.classList.add("modal-open");
  document.body.style.top = `-${scrollY}px`;
}

function unlockBodyScroll(){
  document.body.classList.remove("modal-open");
  document.body.style.top = "";
  window.scrollTo(0, scrollY);
}
  function openModal(post){
    if(!modal) return;

    modal.classList.add("open");
    modal.setAttribute("aria-hidden", "false");

    pmTitle.textContent = post.titulo || "";
    pmAuthor.textContent = post.autor || "";
    pmDate.textContent = post.data || "";

    if (post.imagemUrl){
      pmImage.src = resolveImageSrc(post.imagemUrl);
      pmImage.alt = post.titulo || "Imagem do post";
      pmImage.style.display = "block";
    } else {
      pmImage.style.display = "none";
    }

    if (post.autorFotoUrl){
pmAuthorPhoto.src = post.autorFotoUrl? resolveImageSrc(post.autorFotoUrl): "https://static.wixstatic.com/media/0f9e1a_1308865ec7204a58948ef759065c86b7~mv2.jpg";
      pmAuthorPhoto.alt = post.autor || "Autor";
      pmAuthorPhoto.style.display = "block";
    } else {
      pmAuthorPhoto.style.display = "none";
    }

    pmBody.textContent = post.conteudo || post.textoCentral || "";

    // ===== SHARE (WhatsApp + copiar link) =====
    const slug = (post.slug || slugify(post.titulo || ""));
    const url = buildPostUrl(slug);

    history.pushState(null, "", `#${encodeURIComponent(slug)}`);

    const shareText = `Veja este post do Verde Tom: ${post.titulo || ""}\n${url}`;

    const wa = document.getElementById("shareWhatsApp");
    if (wa){
      wa.href = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
    }

    const btnCopy = document.getElementById("copyLink");
    if (btnCopy){
      btnCopy.onclick = async () => {
        try{
          await navigator.clipboard.writeText(url);
          const old = btnCopy.textContent;
          btnCopy.textContent = "Link copiado!";
          setTimeout(() => btnCopy.textContent = old || "Copiar link", 1400);
        } catch {
          prompt("Copie o link:", url);
        }
      };
    }
    // ===== /SHARE =====
    lockBodyScroll();
  }

  function closeModal(){
    if(!modal) return;
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
    unlockBodyScroll();
    history.pushState(null, "", window.location.href.split("#")[0]);
  }

  btnClose?.addEventListener("click", closeModal);
  modal?.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

  modal.addEventListener("wheel", (e) => {
  // se o scroll for no backdrop (cinza), bloqueia
  if (e.target === modal) e.preventDefault();
}, { passive: false });

modal.addEventListener("touchmove", (e) => {
  if (e.target === modal) e.preventDefault();
}, { passive: false });

  function openPostBySlug(slug){
    const s = decodeURIComponent(String(slug || "")).trim();
    if(!s) return;

    const idx = posts.findIndex(p => (p.slug || slugify(p.titulo || "")) === s);
    if (idx >= 0) openModal(posts[idx]);
  }

  try{
    const res = await fetch(CSV_URL, { cache: "no-store" });
    if(!res.ok) throw new Error("Falha ao buscar CSV: " + res.status);
    const csv = await res.text();

    posts = parseCSV(csv)
      .filter(p => (p.status || "").toLowerCase() === "publicado");

    posts.sort((a,b) => (b.data || "").localeCompare(a.data || ""));

    const grid = document.getElementById("blogGrid");
    if(!grid) return;

    grid.innerHTML = posts.map((p, idx) => {
      const previewBase = p.textoCentral || p.conteudo || "";
      const preview = truncateByDevice(previewBase);
      const slug = (p.slug || slugify(p.titulo || ""));
      const postUrl = buildPostUrl(slug);

      return `
        <article class="card blog-card" data-post-index="${idx}" data-slug="${slug}" role="button" tabindex="0">
          <div class="blog-card__image">
            ${p.imagemUrl ? `<img src="${resolveImageSrc(p.imagemUrl)}" alt="${p.titulo || ""}">` : ""}
          </div>

          <div class="blog-card__body">
            <h3>${p.titulo || ""}</h3>
            <p class="blog-card__preview">${preview}</p>
            <div></div>

            <div class="blog-card__meta">
              ${p.autorFotoUrl
                ? `<img class="blog-card__avatar" src="${resolveImageSrc(p.autorFotoUrl)}" alt="${p.autor || ""}">`
                : `<div class="blog-card__avatar"></div>`
              }
              <div class="blog-card__meta-text">
                <div class="blog-card__author">${p.autor || ""}</div>
                <a class="blog-card__more" href="${postUrl}" onclick="event.preventDefault()">ler mais</a>
              </div>
            </div>
          </div>
        </article>
      `;
    }).join("") || `<p class="small">Nenhum post publicado ainda.</p>`;

    grid.addEventListener("click", (e) => {
      const card = e.target.closest(".blog-card");
      if (!card) return;

      const i = Number(card.getAttribute("data-post-index"));
      const slug = card.getAttribute("data-slug");
      history.pushState(null, "", `#${encodeURIComponent(slug)}`);
      openModal(posts[i]);
    });

    grid.addEventListener("keydown", (e) => {
      if (e.key !== "Enter" && e.key !== " ") return;
      const card = e.target.closest(".blog-card");
      if (!card) return;

      e.preventDefault();
      const i = Number(card.getAttribute("data-post-index"));
      const slug = card.getAttribute("data-slug");
      history.pushState(null, "", `#${encodeURIComponent(slug)}`);
      openModal(posts[i]);
    });

    // ✅ abre automaticamente se tiver #slug na URL
    const hashSlug = decodeURIComponent((window.location.hash || "").replace("#","").trim());
    if (hashSlug) openPostBySlug(hashSlug);

    window.addEventListener("hashchange", () => {
      const s = decodeURIComponent((window.location.hash || "").replace("#","").trim());
      if (s) openPostBySlug(s);
    });

  } catch(err){
    console.error(err);
  }
})();
</script>


</body>
</html>
